<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Endpoint - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Endpoint.html">Endpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#.link">link</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#_init_follower">_init_follower</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#_init_leader">_init_leader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#_send">_send</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#broadcast">broadcast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#close">close</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#handler">handler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#onlink">onlink</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#receive">receive</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Endpoint.html#wait">wait</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Mailbox.html">Mailbox</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#close">close</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#isempty">isempty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#mails">mails</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#match">match</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#matchany">matchany</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#put">put</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Mailbox.html#toJSON">toJSON</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MailboxWorker.html">MailboxWorker</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#_condition">_condition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#_conditions">_conditions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#dispatch">dispatch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#onclear">onclear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#onclose">onclose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#onmatch">onmatch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MailboxWorker.html#onput">onput</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Msg.html">Msg</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SessionEvent.html">SessionEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SessionEvent.html#.Recv">Recv</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SessionEvent.html#.Send">Send</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Sock.html">Sock</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sock.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sock.html#close">close</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sock.html#connect">connect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sock.html#disconnect">disconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sock.html#send">send</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">Endpoint</h1>
    

    




<section>

<header>
    
        <h2>
        Endpoint
        </h2>
        
            <div class="class-description"><p>An endpoint is an abstraction over sockets that provides session initiation, 
broadcasting, and linking/forwarding capabilities.</p></div>
        
    
</header>

<article>
    <div class="container-overview">
    
        
<div class="section-method">

    
    <h2>Constructor</h2>
    

    <h4 class="name" id="Endpoint"><span class="type-signature"></span>new Endpoint<span class="signature">(brokeraddr, roles)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Construct an endpoint.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line22">line 22</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>brokeraddr</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>String</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The address of the broker device.</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>roles</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Array.html">Array</a>.&lt;Int></code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The roles</p>
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>
    
    </div>

    

    

    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<div class="section-members">
<h4 class="name" id="broker"><span class="type-signature"></span>broker<span class="type-signature"> :nanomsg.Device</span></h4>




<div class="description">
    <p>The broker loopback device, provided by the nanomsg.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line63">line 63</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code>nanomsg.Device</code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="brokeraddr"><span class="type-signature"></span>brokeraddr<span class="type-signature"> :String</span></h4>








<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line57">line 57</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code>String</code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="id"><span class="type-signature"></span>id<span class="type-signature"> :uuid</span></h4>








<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line35">line 35</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code>uuid</code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="mbox"><span class="type-signature"></span>mbox<span class="type-signature"> :<a href="Mailbox.html">Mailbox</a></span></h4>








<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line52">line 52</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code><a href="Mailbox.html">Mailbox</a></code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="peers"><span class="type-signature"></span>peers<span class="type-signature"> :<a href="Map.html">Map</a>.&lt;Int, uuid></span></h4>




<div class="description">
    <p>A mapping from roles to endpoint id's.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line47">line 47</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code><a href="Map.html">Map</a>.&lt;Int, uuid></code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="roles"><span class="type-signature"></span>roles<span class="type-signature"> :<a href="Set.html">Set</a>.&lt;Int></span></h4>




<div class="description">
    <p>A set of roles played by this endpoint.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line41">line 41</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code><a href="Set.html">Set</a>.&lt;Int></code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="sock"><span class="type-signature"></span>sock<span class="type-signature"> :<a href="Sock.html">Sock</a></span></h4>








<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line68">line 68</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code><a href="Sock.html">Sock</a></code></span>


        </li>
    </ul>





</div>

        
            
<div class="section-members">
<h4 class="name" id="state"><span class="type-signature"></span>state<span class="type-signature"> :"init"|"ready"|"active"|"linking"|"closing"</span></h4>








<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line73">line 73</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code>"init"</code></span>
|

<span class="param-type"><code>"ready"</code></span>
|

<span class="param-type"><code>"active"</code></span>
|

<span class="param-type"><code>"linking"</code></span>
|

<span class="param-type"><code>"closing"</code></span>


        </li>
    </ul>





</div>

        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            
<div class="section-method">

    

    <h4 class="name" id=".link"><span class="type-signature">(async, static) </span>link<span class="signature">(ep1, ep2)</span><span class="type-signature"> &rarr; {<a href="Endpoint.html">Endpoint</a>}</span></h4>

    



<div class="description">
    <p>Cut with Spill.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line433">line 433</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ep1</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Endpoint.html">Endpoint</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ep2</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Endpoint.html">Endpoint</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code><a href="Endpoint.html">Endpoint</a></code></span>


    </dd>
</dl>


<div class="param-desc">
    <p>Given <code>EP1</code> of roles <code>R1</code> and <code>EP2</code> with roles <code>R2</code>, 
the function will perform a cut-with-spill by:</p>
<ol>
<li>Choose the (possibly) non-empty mailbox one as <code>KEEP</code>, and the other as <code>KILL</code>. </li>
<li>Set <code>KEEP</code> role to be <code>R1 \intersect R2</code>.</li>
<li>Connects the network involving <code>KILL</code> with the network involving <code>KEEP</code>.</li>
<li>Updates the peers in the combined network.</li>
</ol>
<p>During a cut of two endpoints, we are in the following situation (case-sensitive): </p>
<pre class="prettyprint source"><code>{ep1, ...} &lt;=> EP1  &lt;- to be cut with -> EP2 &lt;=> {ep2, ...}</code></pre><p>And at most one of (<code>EP1</code>, <code>EP2</code>)'s mailbox must be empty since:</p>
<ol>
<li>All of the <code>ep</code> and <code>EP</code> should now be blocked on receive (or similar).</li>
<li>And based on the protocol, no two endpoints in the same session 
can send at the same time.</li>
<li>There must be someone that has performed all the send and 
then is blocked at a receive (or similar).</li>
<li>All others start from a receive.</li>
<li>As a result, if someone from <code>{ep1, ...}</code> sends, then <code>EP1</code> has non-empty mailbox.
And correspondingly, <code>EP2</code> must contain the sending role, and therefore <code>EP2</code> has 
an empty mailbox, no matter the receiving role is in <code>EP2</code> or not.</li>
<li>This sending operation(s), should be considered incomplete, and should be replayed 
after the new session is formed. </li>
</ol>
<h5>In-coming Messages:</h5><pre class="prettyprint source"><code>link: <a href="Msg.html#.LinkReply">Msg.LinkReply</a></code></pre><h5>Out-going Messages:</h5><pre class="prettyprint source"><code>link: <a href="Msg.html#.LinkRequest">Msg.LinkRequest</a>
go:   <a href="Msg.html#.Go">Msg.Go</a></code></pre>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="_init_follower"><span class="type-signature">(async, protected) </span>_init_follower<span class="signature">(fullroles)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Coordinate the session initiation as a follower.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line194">line 194</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>fullroles</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Array.html">Array</a>.&lt;Int></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


<div class="param-desc">
    <h5>Out-going Messages:</h5><pre class="prettyprint source"><code>init  <a href="Msg.html#.Init">Msg.Init</a>
ready <a href="Msg.html#.ReadyReply">Msg.ReadyReply</a></code></pre><h5>In-coming Messages:</h5><pre class="prettyprint source"><code>ready <a href="Msg.html#.ReadyRequest">Msg.ReadyRequest</a>
go    <a href="Msg.html#.Go">Msg.Go</a></code></pre>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="_init_leader"><span class="type-signature">(async, protected) </span>_init_leader<span class="signature">(fullroles)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Coordinate the session initiation as a leader.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line142">line 142</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>fullroles</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Array.html">Array</a>.&lt;Int></code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The full set of roles.</p>
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


<div class="param-desc">
    <h5>Out-going Messages:</h5><pre class="prettyprint source"><code>ready <a href="Msg.html#.ReadyRequest">Msg.ReadyRequest</a>
go    <a href="Msg.html#.Go">Msg.Go</a></code></pre><h5>In-coming Messages:</h5><pre class="prettyprint source"><code>init  <a href="Msg.html#.Init">Msg.Init</a>
ready <a href="Msg.html#.ReadyReply">Msg.ReadyReply</a></code></pre>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="_send"><span class="type-signature">(protected) </span>_send<span class="signature">(payload, receiver, label)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Send a message to a specific receiver.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line281">line 281</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>payload</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last">
                <p>JSON serializable object.</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>receiver</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>uuid</code></span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last">
                <p>A single receiver. This is the uuid, since during link, the 
                                endpoint may send to an out-of-session party.</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>label</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>String</code></span>


            
            </td>

            

            
                <td class="default">
                
                    "send"
                
                </td>
            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="broadcast"><span class="type-signature"></span>broadcast<span class="signature">(payload, label)</span><span class="type-signature"> &rarr; {void}</span></h4>

    



<div class="description">
    <p>Broadcast a payload to all peers.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line265">line 265</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>payload</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last">
                <p>JSON serializable object.</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>label</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>String</code></span>


            
            </td>

            

            
                <td class="default">
                
                    "send"
                
                </td>
            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>void</code></span>


    </dd>
</dl>


    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="close"><span class="type-signature">(async) </span>close<span class="signature">()</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Close all the sockets and mailboxes.</p>
<p>Note that the device is not closed, since it can only be closed by <code>nanomsg.term()</code>.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line326">line 326</a>
    </li></ul></dd>
    

    

    

    
</dl>





















<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


<div class="param-desc">
    <h5>Out-going Messages:</h5><pre class="prettyprint source"><code>go    <a href="Msg.html#.Go">Msg.Go</a></code></pre><h5>In-coming Messages:</h5><pre class="prettyprint source"><code>close <a href="Msg.html#.Close">Msg.Close</a>
link  <a href="Msg.html#.LinkRequest">Msg.LinkRequest</a></code></pre>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="handler"><span class="type-signature"></span>handler<span class="signature">(msg)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>The default message handler.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line80">line 80</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>msg</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Msg.html">Msg</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="init"><span class="type-signature">(async) </span>init<span class="signature">(fullroles)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Initiate a session.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line227">line 227</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>fullroles</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Array.html">Array</a>.&lt;Int></code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The full set of roles.</p>
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="onlink"><span class="type-signature">(async) </span>onlink<span class="signature">(msg)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Respond to the <code>link</code> request.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line515">line 515</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>msg</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Msg.html#.LinkRequest">Msg.LinkRequest</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


<div class="param-desc">
    <p>Handling the <code>link</code> message. The states to be changed include:</p>
<ul>
<li><code>peers</code>: Since we linked two endpoints, the peer map changed.</li>
<li><code>brokeraddr</code>: 
   Before linking, there were two leaders, and as a result, two devices.
   After linking, they will all be connected to one of the device, 
   that originally belongs to the <code>KEEP</code>'s leader. </li>
</ul>
<h5>In-coming Messages</h5><pre class="prettyprint source"><code>link <a href="Msg.html#.LinkRequest">Msg.LinkRequest</a>
go   <a href="Msg.html#.Go">Msg.Go</a></code></pre><h5>Out-going Messages</h5><pre class="prettyprint source"><code>link <a href="Msg.html#.LinkReply">Msg.LinkReply</a></code></pre>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="receive"><span class="type-signature">(async) </span>receive<span class="signature">(sender)</span><span class="type-signature"> &rarr; {Object}</span></h4>

    



<div class="description">
    <p>Receive a message from a particular sender.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line298">line 298</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>sender</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Int</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The role of the sender.</p>
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Object</code></span>


    </dd>
</dl>


<div class="param-desc">
    <p>The message payload.       </p>
<h5>In-coming Messages:</h5><pre class="prettyprint source"><code>send <a href="Msg.html#.Send">Msg.Send</a>
link <a href="Msg.html#.LinkRequest">Msg.LinkRequest</a></code></pre>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="toJSON"><span class="type-signature"></span>toJSON<span class="signature">()</span><span class="type-signature"> &rarr; {<a href="Endpoint.html#.JSON">Endpoint.JSON</a>}</span></h4>

    







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line116">line 116</a>
    </li></ul></dd>
    

    

    

    
</dl>





















<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code><a href="Endpoint.html#.JSON">Endpoint.JSON</a></code></span>


    </dd>
</dl>


    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="wait"><span class="type-signature">(async) </span>wait<span class="signature">(closer)</span><span class="type-signature"> &rarr; {Void}</span></h4>

    



<div class="description">
    <p>Synchonoursly close the endpoint as a follower. This operation tries to sync
with the broker (role 0) with a close message. When the broker collects all the &quot;close&quot;, 
it will let all clients close.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line370">line 370</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>closer</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Int</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The role of the closing endpoint.</p>
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Void</code></span>


    </dd>
</dl>


<div class="param-desc">
    <h5>Out-going Messages:</h5><pre class="prettyprint source"><code>close Messages:</h5><pre class="prettyprint source"><code>go    <a href="Msg.html#.Close">link  {@link Msg.LinkRequest</a></code></pre>
</div>

    
</div>



</div>
        
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<div class="section-members">
<h4 class="name" id=".JSON">JSON</h4>








    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>id</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>uuid</code></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

        

    

        <tr>
            
                <td class="name"><code>mbox</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Mailbox.html#.JSON">Mailbox.JSON</a></code></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

        

    

        <tr>
            
                <td class="name"><code>roles</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Array.html">Array</a>.&lt;Int></code></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

        

    

        <tr>
            
                <td class="name"><code>peers</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Array.html">Array</a>.&lt;Tuple.&lt;Int, uuid>></code></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

        

    

        <tr>
            
                <td class="name"><code>state</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>String</code></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

        

    

        <tr>
            
                <td class="name"><code>brokeraddr</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>String</code></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

        

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="endpoint.js.html">endpoint.js</a>, <a href="endpoint.js.html#line103">line 103</a>
    </li></ul></dd>
    

    

    

    
</dl>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><code>Object</code></span>


        </li>
    </ul>





</div>

            
    

    
</article>

</section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Dec 28 2017 11:24:51 GMT-0500 (EST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>